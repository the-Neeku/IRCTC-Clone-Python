{% extends 'base1.html' %}
{% load static %}
{% block extra_links %}
<link rel="stylesheet" href="{% static 'CSS/index.css'%}">
<script>
const addBtn = document.getElementById('add-passenger');
if (addBtn) {
    addBtn.addEventListener('click', function () {
        const forms = document.getElementsByClassName('passenger-form');
        if (forms.length >= 6) {
            alert('Maximum 6 passengers allowed per booking');
            return;
        }

        const formNum = forms.length;
        const newForm = forms[0].cloneNode(true);
        newForm.innerHTML = newForm.innerHTML.replace(/passengers-0/g, `passengers-${formNum}`);
        newForm.innerHTML = newForm.innerHTML.replace(/passengers_set-0/g, `passengers_set-${formNum}`);
        newForm.querySelector('.card-title').textContent = `Passenger ${formNum + 1}`;

        newForm.querySelectorAll('input').forEach(input => input.value = '');
        newForm.querySelectorAll('select').forEach(select => select.selectedIndex = 0);

        document.getElementById('passenger-forms').appendChild(newForm);

        const totalForms = document.querySelector('#id_passengers-TOTAL_FORMS');
        totalForms.value = forms.length + 1;
    });
}
</script>
{% endblock %}
{% block title %}Book Ticket - IRCTC Clone{% endblock %}

{% block content %}
<div class="card mt-5 mb-5" style="width: 70%;">
    <div class="card-header">
        <h3 class="card-title mb-0">Book Ticket</h3>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}

            <h4>Your Details</h4>
            <div class="mb-3">
                <label for="name" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>

            <div class="mb-3">
                <label for="from_station" class="form-label">From Station</label>
                <input type="text" class="form-control" id="from_station" name="from_station" required>
            </div>

            <div class="mb-3">
                <label for="train_name" class="form-label">Train Name</label>
                <input type="text" class="form-control" id="train_name" name="train_name" required>
            </div>

            <div class="mb-3">
                <label for="train_no" class="form-label">Train Number</label>
                <input type="text" class="form-control" id="train_no" name="train_no" required>
            </div>


            <div class="mb-3">
                <label for="to_station" class="form-label">To Station</label>
                <input type="text" class="form-control" id="to_station" name="to_station" required>
            </div>

            <div class="mb-3">
                <label for="date" class="form-label">Journey Date</label>
                <input type="date" class="form-control" id="date" name="date" required>
            </div>

            <div class="mb-3">
                <label for="seats" class="form-label">Number of Seats</label>
                <input type="number" class="form-control" id="seats" name="seats" min="1" max="6" required>
            </div>

            <!-- Optional Passenger Details Formset -->
            {% if passenger_formset %}
            <h4 class="mt-4">Passenger Details</h4>
            {{ passenger_formset.management_form }}
            <div id="passenger-forms">
                {% for form in passenger_formset %}
                <div class="passenger-form card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Passenger {{ forloop.counter }}</h5>
                        {% for field in form %}
                        <div class="mb-2">
                            {{ field.label_tag }} {{ field }}
                            {% if field.errors %}
                            <div class="text-danger">{{ field.errors }}</div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="mb-3 text-end">
                <button type="button" class="btn btn-outline-primary" id="add-passenger">âž• Add Passenger</button>
            </div>
            {% endif %}

            <div class="text-center">
                <button type="submit" class="btn btn-success px-4">Book Now</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
